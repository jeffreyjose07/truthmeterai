# Root Cause Analysis (RCA) - Missing Dashboard Data

## Issue
The "AI Activity", "Flow Timeline", and "AI Risk Heatmap" charts in the dashboard are empty ("not seeing anything").

## Root Cause Analysis

### 1. AI Activity (Missed Detection) - **PRIMARY CAUSE**
The `AIEventCollector` uses strict heuristics that fail to detect **streaming AI completions** (like Copilot or Cursor) because they insert text in small chunks.

*   **Current Logic:**
    *   `MIN_INSERTION_SIZE = 30` characters (Heuristic 1).
    *   `MIN_RAPID_TYPING_SIZE = 20` characters (Heuristic 5).
*   **The Problem:**
    *   Modern AI tools stream updates in small tokens (e.g., 5-10 characters at a time).
    *   The current logic checks `totalInserted` **per event**.
    *   If an AI streams 10 chars every 50ms, each individual event fails the size check (> 20), even though 200 chars are inserted in 1 second.
    *   **Result:** Streaming AI generation is ignored as "manual typing".

### 2. AI Risk Heatmap (Dependency Failure)
The Risk Heatmap relies entirely on the `fileStats` object generated by `AIEventCollector`.

*   **The Chain Reaction:**
    *   Because the streaming AI events are not detected (see above), `AIEventCollector` records 0 suggestions.
    *   The `fileStats` object remains empty.
    *   The Dashboard receives no data points for the scatter plot (X: Usage, Y: Churn).
    *   **Result:** The chart is empty because the upstream data source is failing.

### 3. Flow Timeline (High Threshold)
The `TimeTracker` enforces a strict definition of "Flow State" that prevents data from appearing during short sessions or testing.

*   **Current Logic:**
    *   "Flow" requires `currentStreak >= 15 minutes` (900,000ms).
    *   Data is only pushed to `flowBlocks` when this threshold is crossed.
*   **The Problem:**
    *   If the user has been testing for < 15 minutes, **zero flow blocks** exist.
    *   **Result:** Users see nothing until they've worked uninterrupted for 15+ minutes.

## Implementation Plan

### Phase 1: Fix AI Detection (Critical)
1.  **Implement Cumulative Buffer in `AIEventCollector.ts`:**
    *   Create a `recentInsertions` buffer to track changes over a rolling 1-second window.
    *   Sum the lengths of all rapid, sequential insertions.
    *   **New Logic:** If `(Cumulative Chars > 30) AND (Time Window < 1000ms)`, flag as AI event.
    *   This will capture streaming tokens as a single "logical" AI event.

### Phase 2: Improve Flow Visibility
1.  **Expose "In-Progress" Flow:**
    *   Update `TimeTracker.getMetrics()` to include the *current* active session if it's active, even if it hasn't hit the 15-minute mark yet (labeled as "Focus Session").
2.  **UI Handling:**
    *   Update `DashboardProvider.ts` to render these "Focus Sessions" in a different color (e.g., light green) to show activity is being tracked, distinguishing them from confirmed "Deep Work" flow states.

### Phase 3: Dashboard UX Refinements
1.  **Empty State Handling:**
    *   Add visual placeholders in the dashboard HTML when data arrays are empty.
    *   *Heatmap:* "No AI files detected yet."
    *   *Timeline:* "Start coding to see your timeline."